var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{l(n.next(t))}catch(e){o(e)}}function a(t){try{l(n["throw"](t))}catch(e){o(e)}}function l(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){l.label=i[1];break}if(6===i[0]&&l.label<s[1]){l.label=s[1],s=i;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(i);break}s[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(n){i=[6,n],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},App=function(){function t(t){this.initExtension(),t.addChild(fairygui.GRoot.inst.displayObject),this.viewer=fairygui.UIPackage.createObject("Viewer","Main"),this.viewer.setSize(fairygui.GRoot.inst.width,fairygui.GRoot.inst.height),fairygui.GRoot.inst.addChild(this.viewer),this.parser=new FileParser,t.addEventListener(egret.Event.RESIZE,this.onResize,this),this.createFileInput(),this.initDropEvent()}return t.prototype.initExtension=function(){fairygui.UIPackage.addPackage("Viewer"),fairygui.UIObjectFactory.setPackageItemExtension("ui://Viewer/Main",Viewer),fairygui.UIObjectFactory.setPackageItemExtension("ui://Viewer/toolbar",Toolbar),fairygui.UIObjectFactory.setPackageItemExtension("ui://Viewer/componentList",ComponentList)},t.prototype.initDropEvent=function(){var t=this,e=document.querySelector(".egret-player canvas");e.addEventListener("drop",function(e){e.preventDefault();var i=e.dataTransfer;if(void 0!==i.items){for(var n=i.items,r=[],o=0;o<n.length;o++){var s=n[o];if("file"===s.kind&&s.webkitGetAsEntry().isFile){var a=s.getAsFile();r.push(a)}}t.parser.parseFile(r)}}),e.addEventListener("dragover",function(t){t.preventDefault()})},t.prototype.createFileInput=function(){var t=this;this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.style.display="none",this.fileInput.multiple=!0,this.fileInput.addEventListener("change",function(){if(t.fileInput.value){var e=t.fileInput.files;t.parser.parseFile(e),t.fileInput.value=""}}),EventManager.on(Events.EMIT_UPLOAD,this.emitUploadFile,this)},t.prototype.emitUploadFile=function(){var t=new MouseEvent("click",{bubbles:!1,cancelable:!0,view:window});this.fileInput.dispatchEvent(t)},t.prototype.onResize=function(){},t}();__reflect(App.prototype,"App");var FileParser=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parseFile=function(t){for(var e=[],i=!1,n="",r=!1,o=[],s=0;s<t.length;s++){var a=t[s],l=URL.createObjectURL(a);o.push(l);var c=a.name,h=a.type,u=c.split(".");u.pop(),-1!=c.indexOf(".fui")||-1!=c.indexOf(".bin")||-1!=c.indexOf(".xml")||-1!=c.indexOf(".bytes")?(c=u.join(""),c=c.replace(/_fui/g,""),i=!0,n=c):c=u.join(""),h=h.replace("application/octet-stream","bin").replace("image/png","image")||"bin",RES.hasRes(c)?r=!0:(RES.$addResourceData({name:c,type:h,url:l}),e.push(c))}0!=e.length||r?i?(RES.createGroup("import",e,!0),EventManager.emit(Events.SHOW_VIEW),EventManager.emit(Events.UPLOAD_SUCCESS,{pkgName:n,urls:o})):alert("未发现有效的fairygui文件！"):alert("未发现有效的资源文件！")},e}(egret.EventDispatcher);__reflect(FileParser.prototype,"FileParser");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,RES.loadGroup("preload",0)];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),console.error(t),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){new App(this.stage)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var EventManager=function(t){function e(e){return void 0===e&&(e=null),t.call(this,e)||this}return __extends(e,t),e.getInstance=function(){return e._instance=e._instance||new e,e._instance},e.on=function(t,e,i){this.getInstance().addEventListener(t,e,i)},e.off=function(t,e,i){this.getInstance().removeEventListener(t,e,i)},e.emit=function(t,e){this.getInstance().dispatchEventWith(t,!1,e)},e}(egret.EventDispatcher);__reflect(EventManager.prototype,"EventManager");var Events=function(){function t(){}return t.UPLOAD_SUCCESS="upload_success",t.SHOW_VIEW="show_view",t.UPDATE_VIEW="update_view",t.DELETE_VIEW="delete_view",t.SHOW_LIST="show_list",t.HIDE_LIST="hide_list",t.INIT_LIST="init_list",t.EMIT_UPLOAD="emit_upload",t}();__reflect(Events.prototype,"Events");var ComponentList=function(t){function e(){var e=t.call(this)||this;return e.listItem="ui://2uyz29olaocdl",e}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this.list=this.getChild("list"),this.trans_show=this.getTransition("show"),this.trans_hide=this.getTransition("hide"),EventManager.on(Events.SHOW_LIST,this.showList,this),EventManager.on(Events.HIDE_LIST,this.hideList,this),EventManager.on(Events.INIT_LIST,this.initList,this)},e.prototype.initList=function(t){var e=this,i=t.data.pkgChildren;this.list.removeChildrenToPool(),this.list.removeEventListener(fairygui.ItemEvent.CLICK,this.onClickItem,this),i.forEach(function(t){var i=e.list.addItem(e.listItem);i.title=t,"Main"==t&&(i.selected=!0)}),this.list.addEventListener(fairygui.ItemEvent.CLICK,this.onClickItem,this)},e.prototype.onClickItem=function(t){var e=t.itemObject,i=e.title;EventManager.emit(Events.UPDATE_VIEW,{name:i})},e.prototype.showList=function(){egret.MainContext.instance.stage.touchChildren=!1,this.trans_show.play(this.toucEnable,this)},e.prototype.hideList=function(){egret.MainContext.instance.stage.touchChildren=!1,this.trans_hide.play(this.toucEnable,this)},e.prototype.toucEnable=function(){egret.MainContext.instance.stage.touchChildren=!0},e}(fairygui.GComponent);__reflect(ComponentList.prototype,"ComponentList");var Toolbar=function(t){function e(){var e=t.call(this)||this;return e.listFlag=!1,e}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this.btn_restore=this.getChild("restore"),this.btn_restore.addClickListener(this.restore,this),this.btn_list=this.getChild("list"),this.btn_list.addClickListener(this.showList,this),this.btn_delete=this.getChild("delete"),this.btn_delete.addClickListener(this.deleteView,this)},e.prototype.restore=function(){window.open("https://github.com/krapnikkk/fgui-restore")},e.prototype.showList=function(){this.listFlag?EventManager.emit(Events.HIDE_LIST):EventManager.emit(Events.SHOW_LIST),this.listFlag=!this.listFlag},e.prototype.deleteView=function(){EventManager.emit(Events.DELETE_VIEW)},e}(fairygui.GComponent);__reflect(Toolbar.prototype,"Toolbar");var Viewer=function(t){function e(){var e=t.call(this)||this;return e.pkgName="",e}return __extends(e,t),e.prototype.constructFromXML=function(e){t.prototype.constructFromXML.call(this,e),this.loader=this.getChild("viewer"),this.tips=this.getChild("gc_tips"),this.canvas=this.getChild("canvas"),this.toolbar=this.getChild("toolbar"),this.link=this.getChild("link"),this.link.addClickListener(this.href,this),this.tips.addClickListener(this.selectFile,this),EventManager.on(Events.SHOW_VIEW,this.showLoader,this),EventManager.on(Events.DELETE_VIEW,this.hideLoader,this),EventManager.on(Events.UPLOAD_SUCCESS,this.createView,this),EventManager.on(Events.UPDATE_VIEW,this.loadViewEvent,this)},e.prototype.showLoader=function(){this.tips.visible=!1,this.canvas.visible=!0,this.toolbar.visible=!0,this.toolbar.listFlag=!1,this.loader.visible=!0},e.prototype.hideLoader=function(){this.tips.visible=!0,this.canvas.visible=!1,this.toolbar.visible=!1,this.loader.visible=!1,EventManager.emit(Events.HIDE_LIST)},e.prototype.selectFile=function(){EventManager.emit(Events.EMIT_UPLOAD)},e.prototype.href=function(){window.location.href="https://github.com/krapnikkk/fgui-viewer"},e.prototype.createView=function(t){var e=this,i=t.data,n=i.pkgName;i.urls;this.pkgName=n,RES.loadGroup("import",0).then(function(){var t=fairygui.UIPackage.addPackage(e.pkgName),i=[],n=t._itemsByName;for(var r in n)3==n[r].type&&i.push(r);EventManager.emit(Events.INIT_LIST,{pkgChildren:i}),e.loadView()})},e.prototype.loadView=function(t){void 0===t&&(t="Main");var e=fairygui.UIPackage.getItemURL(this.pkgName,t);this.loader.url=e},e.prototype.loadViewEvent=function(t){var e=t.data.name;this.loadView(e)},e}(fairygui.GComponent);__reflect(Viewer.prototype,"Viewer");